# Install pentest binaries
def "mysetup pentest binaries" [] {

  # TODO
  # https://github.com/hakluke
  # https://github.com/lc
  # https://github.com/projectdiscovery
  # https://github.com/tomnomnom
  # https://github.com/six2dez/reconftw/blob/main/install.sh
  # https://thibaud-robin.fr/articles/docker-kali
  # https://github.com/s-h-3-l-l/katoolin3
  # https://twitter.com/ScriptKKiddie/status/1428080120997294083
  # enum4linux enum4linux-ng

  let bindir = $"($env.HOME)/.local/binaries"

  echo "Install feroxbuster"
  wget -q https://github.com/epi052/feroxbuster/releases/latest/download/x86_64-linux-feroxbuster.tar.gz -O /tmp/feroxbuster.tgz
  tar --extract -C $bindir --file /tmp/feroxbuster.tgz | ignore

  echo 'Install revshellgen'
  wget -q https://raw.githubusercontent.com/cwinfosec/revshellgen/master/revshellgen.py -O ~/.local/binaries/revshellgen.py

  chmod u+x $"($bindir)/*"

  let msf = (do -i {dpkg-query -W -f='${Status}' metasploit-framework } | complete)
  if ( ($msf).exit_code == 1 ) {
    echo "Install Metasploit"
	  wget -q https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb -O /tmp/msfinstall
	  chmod 755 /tmp/msfinstall
	  /tmp/msfinstall | ignore
  }

  let stegseek = (do -i {dpkg-query -W -f='${Status}' stegseek } | complete)
  if ( ($stegseek).exit_code == 1 ) {
    curl -sSL (github latestdownload  RickdeJager/stegseek deb).0 -o /tmp/stegseek.deb
    sudo DEBIAN_FRONTEND=noninteractive apt-get install -qq -y /tmp/stegseek.deb | ignore
  }

  if (not ('/opt/john-jumbo' | path exists)) {
    echo 'Install John Jumbo'
	  sudo DEBIAN_FRONTEND=noninteractive apt-get install -qq -y libbz2-dev libpcap-dev | ignore
	  git clone --quiet --depth 1 https://github.com/magnumripper/JohnTheRipper /opt/john-jumbo | ignore
  	cd /opt/john-jumbo/src
    ./configure | ignore
    make -s clean | ignore
    make -sj4 | ignore
    sudo make install | ignore
  }

  if (not ('/opt/massdns' | path exists)) {
	  echo "Installing MassDns"
	  git clone -q --depth 1 https://github.com/blechschmidt/massdns.git /opt/massdns | ignore
	  make -C /opt/massdns/ | ignore
    cd /opt/massdns
    sudo make install | ignore
  }

} 
